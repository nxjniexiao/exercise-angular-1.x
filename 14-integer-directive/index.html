<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Integer</title>
</head>
<body ng-app="myApp" ng-controller="MyController">
<input type="text" ng-model="number" integer required>
<div>{{number}}</div>
<script src="../lib/angular.min.js"></script>
<script>
  (function (angular) {
    angular.module('myApp', []).controller('MyController', [
      '$scope',
      function ($scope) {
        $scope.number = null;
      }
    ]);
    angular.module('myApp').directive('integer', [function () {
      return {
        restrict: 'A',
        require: '?ngModel',
        link: function(scope, element, attrs, ngModelCtrl) {
          if (!ngModelCtrl) {
            return;
          }
          // (Summarize: parsers change how view values will be saved in the model.)
          // ngModelCtrl.$parsers is array of functions to execute, as a pipeline,
          // whenever the control reads value from the DOM.
          ngModelCtrl.$parsers.push(function (value) {
            console.log(value);
            var validValue = value.replace(/[^0-9]+/g, '');
            // Update the view value.
            ngModelCtrl.$setViewValue(validValue);
            // Called when the view needs to be updated
            ngModelCtrl.$render();
            return validValue;
          });
          element.bind('keypress', function (event) {
            console.log('keyCode: ' + event.keyCode);
            // 防止输入空格
            if (event.keyCode === 32) {
              event.preventDefault();
            }
          });
        }
      };
    }])
  })(window.angular);
</script>
</body>
</html>
